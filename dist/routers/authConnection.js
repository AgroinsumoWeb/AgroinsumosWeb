"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));require("dotenv").config();var _require=require("express"),Router=_require.Router,bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken"),router=Router(),Usuarios=require("../models/users");router.post("/token",function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){var d,e,f,g,h;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=b.body,e=d.username,f=d.password,a.prev=1,a.next=4,Usuarios.findOne({username:e},{auditoria:0});case 4:if(g=a.sent,g){a.next=7;break}return a.abrupt("return",c.status(500).json("El usuario ingresado es incorrecta."));case 7:if(bcrypt.compareSync(f,g.password)){a.next=11;break}return a.abrupt("return",c.status(500).json("La contrase\xF1a ingresada es incorrecta"));case 11:h=jwt.sign({_id:g._id},process.env.SECRET_TOKEN,{expiresIn:86400}),c.status(200).header("auth-token",h).json({_id:g._id,username:g.username});case 13:a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](1),c.status(500).json(a.t0.message);case 18:case"end":return a.stop();}},a,null,[[1,15]])}));return function(){return a.apply(this,arguments)}}()),module.exports=router;